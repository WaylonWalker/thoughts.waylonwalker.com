[{"title":"Column INSERT/UPDATE Defaults — SQLAlchemy 1.4 Documentation","link":"https://docs.sqlalchemy.org/en/14/core/defaults.html#server-invoked-ddl-explicit-default-expressions","tags":"python, sql, sqlalchemy","message":"sqlalchemy server_defaults end up as defaults in the database when new values are inserted.\n\n``` python\nt = Table(\n    \"test\",\n    metadata_obj,\n    Column(\"abc\", String(20), server_default=\"abc\"),\n    Column(\"created_at\", DateTime, server_default=func.sysdate()),\n    Column(\"index_value\", Integer, server_default=text(\"0\")),\n)\n\n```\n\n``` sql\nCREATE TABLE test (\n    abc varchar(20) default 'abc',\n    created_at datetime default sysdate,\n    index_value integer default 0\n)\n```","published":true,"id":45},{"title":"Template Designer Documentation — Jinja Documentation (3.1.x)","link":"https://jinja.palletsprojects.com/en/3.1.x/templates/#include","tags":"python, webdev, jinja2","message":"A feature of jinja that I just discovered is including sub templates. Here is an example from the docs.\n\n\n``` html\n{% include 'header.html' %}\nBody goes here.\n{% include 'footer.html' %}\n```\n\nAnd inside of my thoughts project I used it to render posts.\n\n``` html\n<ul id='posts'>\n    {% for post in posts.__root__ %}\n    {% include 'post_item.html' %}\n    {% endfor %}\n</ul>\n```\n\n> note that post_item.html automatically inherits the post variable.","published":true,"id":44},{"title":"Templates - FastAPI","link":"https://fastapi.tiangolo.com/advanced/templates/","tags":"python, fastapi, webdev","message":"A guide to add Jinja2Templates to fastapi.","published":true,"id":43},{"title":"</> htmx ~ Documentation","link":"https://htmx.org/docs/#swapping","tags":"htmx, webdev","message":"A complete reference of all of the htmx swapping methods.","published":true,"id":42},{"title":"python 3.x - FastAPI redirection for trailing slash returns non-ssl link - Stack Overflow","link":"https://stackoverflow.com/questions/63511413/fastapi-redirection-for-trailing-slash-returns-non-ssl-link","tags":"fastapi, webdev","message":"I am trying to use htmx on a new fastapi site for my thoughts, and have been hitting this error. \n\n``` js\nMixed Content: The page at 'https://front.mydomain.com/#/clients/1' was loaded over HTTPS, but requested an insecure resource 'http://back.mydomain/jobs/?_end=25&_order=DESC&_sort=id&_start=0&client_id=1'. This request has been blocked; the content must be served over HTTPS.\n```\n\n## What is happening\n\nI have an htmx component that gets the current users name, but if they are not logged in the backend redirects to a login form.\n\n``` html\n        <div hx-get='/users/me' hx-trigger='load'>\n            get me\n        </div>\n```\n\nBut for some reason when the front end gets this redirect, it tries to do it through http, and flags it as insecure.\n\n## The solution\n\nTo solve this issue, the post directs to set the `--forwarded-allow-ips` to '*'\n\n``` bash\nuvicorn thoughts.api.app:app --port 5000 --reload --log-level info --host 0.0.0.0 --workers 1 --forwarded-allow-ips '*'\n```","published":true,"id":40},{"title":"</> htmx ~ The client-side-templates Extension","link":"https://htmx.org/extensions/client-side-templates/","tags":"htmx, webdev","message":"Using templates with htmx requires the client-side-templates extension, and the template engine to be loaded in a `<script>` tag.\n\nexample htmx using templates.\n\n``` html\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width\">\n  <script src=\"https://unpkg.com/htmx.org\"></script>\n  <script src=\"https://unpkg.com/htmx.org/dist/ext/client-side-templates.js\"></script>\n  <script src=\"https://unpkg.com/mustache@latest\"></script>\n</head>\n<body>\n  <div hx-ext=\"client-side-templates\">\n    <button hx-get=\"https://jsonplaceholder.typicode.com/todos/1\"\n            hx-swap=\"innerHTML\"\n            hx-target=\"#content\"\n            mustache-template=\"foo\">\n      Click Me\n    </button>\n\n    <p id=\"content\">Start</p>\n\n    <template id=\"foo\">\n      <p> {% raw %}{{userID}}{% endraw %} and {% raw %}{{id}}{% endraw %} and {% raw %}{{title}}{% endraw %} and {% raw %}{{completed}}{% endraw %}</p>\n    </template>\n  </div>\n</body>\n</html>\n```","published":true,"id":39},{"title":"Static Files - FastAPI","link":"https://fastapi.tiangolo.com/tutorial/static-files/","tags":"python, fastapi, webdev","message":"Mounting static files in fastapi.\n\n``` python\nfrom fastapi import FastAPI\nfrom fastapi.staticfiles import StaticFiles\n\napp = FastAPI()\n\napp.mount(\"/static\", StaticFiles(directory=\"static\"), name=\"static\")\n```","published":true,"id":38},{"title":"(109) HTMX looks pretty neat #coding #javascript - YouTube","link":"https://www.youtube.com/shorts/IqE7juQBr6A","tags":"htmx, webdev","message":"Love the poling example with hx-trigger='every 1s'.","published":true,"id":37},{"title":"First-class session support in FastAPI · Issue #754 · tiangolo/fastapi","link":"https://github.com/tiangolo/fastapi/issues/754","tags":"python, fastapi, security","message":"Here is a snippet provided by @tiangolo to store the users jwt inside of a session cookie in fatapi.  This was written in feb 12, 2020 and admits that this is not a well documented part of fastapi.\n\n> It's already in place. More or less like the rest of the security tools. And it's compatible with the rest of the parts, integrated with OpenAPI (as possible), but probably most importantly, with dependencies.\n\n> It's just not properly documented yet. 😞\n\n> But still, it works 🚀 e.g.\n\n``` python\nfrom fastapi import FastAPI, Form, HTTPException, Depends\nfrom fastapi.security import APIKeyCookie\nfrom starlette.responses import Response, HTMLResponse\nfrom starlette import status\nfrom jose import jwt\n\n\napp = FastAPI()\n\ncookie_sec = APIKeyCookie(name=\"session\")\n\nsecret_key = \"someactualsecret\"\n\nusers = {\"dmontagu\": {\"password\": \"secret1\"}, \"tiangolo\": {\"password\": \"secret2\"}}\n\n\ndef get_current_user(session: str = Depends(cookie_sec)):\n    try:\n        payload = jwt.decode(session, secret_key)\n        user = users[payload[\"sub\"]]\n        return user\n    except Exception:\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN, detail=\"Invalid authentication\"\n        )\n\n\n@app.get(\"/login\")\ndef login_page():\n    return HTMLResponse(\n        \"\"\"\n        <form action=\"/login\" method=\"post\">\n        Username: <input type=\"text\" name=\"username\" required>\n        <br>\n        Password: <input type=\"password\" name=\"password\" required>\n        <input type=\"submit\" value=\"Login\">\n        </form>\n        \"\"\"\n    )\n\n\n@app.post(\"/login\")\ndef login(response: Response, username: str = Form(...), password: str = Form(...)):\n    if username not in users:\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN, detail=\"Invalid user or password\"\n        )\n    db_password = users[username][\"password\"]\n    if not password == db_password:\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN, detail=\"Invalid user or password\"\n        )\n    token = jwt.encode({\"sub\": username}, secret_key)\n    response.set_cookie(\"session\", token)\n    return {\"ok\": True}\n\n\n@app.get(\"/private\")\ndef read_private(username: str = Depends(get_current_user)):\n    return {\"username\": username, \"private\": \"get some private data\"}\n```\n\n","published":true,"id":36},{"title":"Harlequin SQL IDE - DuckDB","link":"https://duckdb.org/docs/guides/sql_editors/harlequin","tags":"python, data, duckdb, textual, harlequin","message":"Harlequin is a pretty sweet example of what textual can be used to create.   Its a terminal based sql ide for DuckDB.","published":true,"id":35},{"title":"Python API - DuckDB","link":"https://duckdb.org/docs/api/python/overview.html","tags":"python, data, duckdb","message":"To persist data in duckdb you need to first make a connection to a duck db database.\n\n``` python\ncon = duckdb.connect('file.db')\n```\n\nThen work off of the connection `con` rather than `duckdb`.\n\n\n``` python\ncon.sql('CREATE TABLE test(i INTEGER)')\ncon.sql('INSERT INTO test VALUES (42)')\n# query the table\ncon.table('test').show()\n# explicitly close the connection\ncon.close()\n```","published":true,"id":34},{"title":"SQL on Pandas - DuckDB","link":"https://duckdb.org/docs/guides/python/sql_on_pandas","tags":"python, data, duckdb, pandas","message":"duckdb can just query any pandas dataframe that is in memory.\n\n> I tried running it against a list of objects and got this error.  Great error message that gives me supported types right in the message.\n\n``` python\nMake sure that \"posts\" is either a pandas.DataFrame, duckdb.DuckDBPyRelation, pyarrow Table, Dataset, RecordBatchReader, Scanner, or NumPy ndarrays with supported format\n```","published":true,"id":33},{"title":"pytest-subtests · PyPI","link":"https://pypi.org/project/pytest-subtests/","tags":"python, pytest","message":"pytest-subtests is a package to register multiple subtests within a similar test function.","published":true,"id":32},{"title":"Dark Form","link":"https://codepen.io/Godex/pen/DLgQbg","tags":"webdev, css","message":"A nice codepen reference for dark forms.   I am using it for my thoughts chrome extension.","published":true,"id":31},{"title":"string","link":"string","tags":"string","message":"string","published":true,"id":30},{"title":"doyensec/wsrepl: WebSocket REPL for pentesters","link":"https://github.com/doyensec/wsrepl","tags":"python, websockets, textual","message":"Very inspiring textual project to check out how they set up the ui.  Their intro video has a pretty epic dev experience.","published":true,"id":29},{"title":"(1) Doyensec on Twitter: \"Announcing wsrepl, the WebSocket testing tool from Doyensec! This intuitive tool is super easy to use and makes automation around WebSockets simple! Check out our blog for the details and download it today! https://t.co/km5m7k6Pb0 #doyensec #appsec #websockets #burpsuite https://t.co/UVLymuSk95\" / Twitter","link":"https://twitter.com/Doyensec/status/1681320727465672706","tags":"python, websockets, textual","message":"wsrepl is an epic websocket repl built in python on the textual framework.","published":true,"id":28},{"title":"Filter Data - WHERE - SQLModel","link":"https://sqlmodel.tiangolo.com/tutorial/where/#filter-rows-using-where-with-sqlmodel","tags":"python, fastapi, sqlmodel, select, where","message":"When fetching pydantic models from the database with sqlmodel, and you cannot select your item by id, you probably need to use a where clause.  This is the sqlmodel way of doing it.\n\n> Here is a snippet of how I am using sqlmodel select and where to find a post by link in my thoughts database.\n\n``` python\n@post_router.get(\"/link/\")\nasync def get_post_by_link(\n    *,\n    session: Session = Depends(get_session),\n    link: str,\n) -> PostRead:\n    \"get one post by link\"\n    link = urllib.parse.unquote(link)\n    print(f'link: {link}')\n    post = session.exec(select(Post).where(Post.link==link)).first()\n    if not post:\n        raise HTTPException(status_code=404, detail=f\"Post not found for link: {link}\")\n\n    return post\n```","published":true,"id":27},{"title":"URL Decoding query strings or form parameters in Python | URLDecoder","link":"https://www.urldecoder.io/python/","tags":"python, urlib, fastapi","message":"In order to turn url encoded links back into links that I would find in the database of my thoughts project I need to urldecode them when they hit the api.  When anything hits the api it must urlencode the links in order for them to be sent correctly as data and not get parsed as part of the url.\n\n\n> Here is a snippet of how I am using urlib.parse.unquote to un-encode encoded urls so that I can fetch posts from the database.\n\n``` python\n@post_router.get(\"/link/\")\nasync def get_post_by_link(\n    *,\n    session: Session = Depends(get_session),\n    link: str,\n) -> PostRead:\n    \"get one post by link\"\n    link = urllib.parse.unquote(link)\n    print(f'link: {link}')\n    post = session.exec(select(Post).where(Post.link==link)).first()\n    if not post:\n        raise HTTPException(status_code=404, detail=f\"Post not found for link: {link}\")\n\n    return post\n```","published":true,"id":26},{"title":"encodeURIComponent() - JavaScript | MDN","link":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent","tags":"javascript, webdev","message":"In order to send data that includes special characters such as `/` in a url you need to url encode it.  You have probably seen these many times in urls with things like %20 for spaces.\n\nI'm working on a chrome extension to make quick blog posts, like thoughts or a persistent bookmark tool with comments.  The backend is written in fastapi and when I check to see if I have a post for a page I need to url encode it.\n\n``` bash\ncurl -X 'GET' \\\n  'https://thoughts.waylonwalker.com/link/?link=https%3A%2F%2Fhtmx.org%2Fextensions%2Fclient-side-templates%2F' \\\n  -H 'accept: application/json'\n```\n\n> curl example generated from the fastapi swagger docs.\n\nHere is how I used javascript's `encodeURIComponent` to turn my chrome extension into a notification when I already have a post for the current page.\n\n``` js\n// Event listener for tab changes\nchrome.tabs.onActivated.addListener(function (activeInfo) {\n  // Get the active tab information\n  chrome.tabs.get(activeInfo.tabId, function (tab) {\n    const url = tab.url || \"\";\n\n    getData(`https://thoughts.waylonwalker.com/link/?link=${encodeURIComponent(url)}`).then((data) => {\n        console.log('link data: ', data);\n      if (data.hasOwnProperty('detail')) {\n        chrome.browserAction.setBadgeText({ text: \"\" });\n      } else {\n        localStorageKey = `formData-${url}`;\n        chrome.browserAction.setBadgeText({ text: \"1\" });\n        chrome.browserAction.setBadgeBackgroundColor({ color: \"#80A3D5\" });\n        localStorage.setItem(localStorageKey, JSON.stringify(data));\n      }\n    });\n  });\n});\n```\n","published":true,"id":25},{"title":"(106) Python Sucks And I LOVE It | Prime Reacts - YouTube","link":"https://www.youtube.com/watch?v=8D7FZoQ-z20&t=97","tags":"python","message":"Prime reviews an article with some hot takes about python being slow and quirky, but good enough for a lot of things.  Especially data applications that have libraries written in C.","published":true,"id":16},{"title":"Changelog on Twitter: \"🗣️ @kelseyhightower on his demos: That happy path gets people out of their chairs. They’re going back to the computer, like: “Yo, I’m gonna try it right now.” Come on… I’d rather have that. And I’ll take the bit of criticism that comes with it. https://t.co/m9r2KZjNQO\" / Twitter","link":"https://twitter.com/changelog/status/1681306857951084544","tags":"soft, presentation","message":"Such an inspiring clip from Kelsey Heightower.  Make good shit that inspires people rather than fake ppts of how things _could_ be.","published":true,"id":15},{"title":"Chris Coyier on Twitter: \"I was unaware of `text-wrap: pretty;` I knew about the (new/cool) `text-wrap: balance;` — but sometimes that's a bit... too much. I feel like it's nice on headers but not smaller type. Here's what I mean.\" / Twitter","link":"https://twitter.com/chriscoyier/status/1681407724993798144","tags":"webdev, css","message":"\nNext time I'm working with large headers on small screens I need to try this.  I always truggle to get them to look good for most text and overflow ridiculously long words correctly or at all.\n\n\n``` css\ntext-wrap: pretty;\ntext-wrap: balance\n```","published":true,"id":14},{"title":"Full-text search - Datasette documentation","link":"https://docs.datasette.io/en/latest/full_text_search.html#enabling-full-text-search-for-a-sqlite-table","tags":"sqlite, data, database","message":"Enable full-text search in sqlite using sqlite-utils.\n\n``` bash\n$ sqlite-utils enable-fts mydatabase.db items name description\n```","published":true,"id":13},{"title":"sqlite-utils command-line tool - sqlite-utils","link":"https://sqlite-utils.datasette.io/en/stable/cli.html#querying-data-directly-using-an-in-memory-database","tags":"sqlite, data, database, sql, json","message":"I want to like jq, but I think Simon is selling me on sqlite, maybe its just me but this looks readable, hackable, editable, memorizable.  Everytime I try jq, and its 5 minutes fussing with it just to get the most basic thing to work.  I know enough sql out of the gate to make this work off the top of my head\n\n\n``` bash\ncurl  https://thoughts.waylonwalker.com/posts/ | sqlite-utils memory - 'select title, message from stdin where stdin.tags like \"%python%\"' | jq\n```\n\n","published":true,"id":12},{"title":"sqlite-utils command-line tool - sqlite-utils","link":"https://sqlite-utils.datasette.io/en/stable/cli.html#inserting-json-data","tags":"sqlite, data, database","message":"insert a json array directly into into sqlite with sqlite-utils.\n\n``` bash\necho '{\"name\": \"Cleo\", \"age\": 4}' | sqlite-utils insert dogs.db dogs -\n```\n\n","published":true,"id":11},{"title":"jq Cheat Sheet","link":"https://lzone.de/cheat-sheet/jq","tags":"jq, ijq, json","message":"A nice cheat sheet for jq. jq looks so nice, but it so quickly gets overwhelming on how to select what you want.  I was able to make a jq contains query.\n\n``` bash\ncurl  https://thoughts.waylonwalker.com/posts/ | jq '.[] | select(.title | contains(\"python\"))'\n```","published":true,"id":10},{"title":"How to Manage 'Systemd' Services and Units Using 'Systemctl' in Linux","link":"https://www.tecmint.com/manage-services-using-systemd-and-systemctl-in-linux/","tags":"linux, systemd","message":"A fantastic overview of the systemd cli.","published":true,"id":9},{"title":"How to fix ZFS pool not importing at boot :: ./techtipsy — Herman's blog","link":"https://ounapuu.ee/posts/2021/02/01/how-to-fix-zfs-pool-not-importing-at-boot/","tags":"linux, zfs, systemd","message":"Hacky solution to get `zpool import tank` to work on boot right away.  This has been an issue that has plagued my system for months and no matter what dependencies I add in it never works, but adding a sleep as ExecStartPre did the trick.","published":true,"id":8},{"title":"Flask Trailing Slashes 404","link":"https://stackoverflow.com/questions/33241050/trailing-slash-triggers-404-in-flask-path-rule","tags":"python, web, flask","message":"In flask apps I often get a 404 for routes with a trailing slash.  This Stack Overflow post shows how to configure flask to allow trailing slashes on some or all routes.","published":true,"id":7},{"title":"Deleting Specific Lines in a File with sed or yq","link":"https://nickjanetakis.com/blog/deleting-specific-lines-in-a-file-with-sed-or-yq","tags":"linux, bash, cli","message":"sed can be a tricky beast, I often stumble when trying to pipe into it.  Next time I need to use sed, I should reference this article by Nick Janetakis.  He makes it looks much easier than my experience has been, and it appears to behave like a vim `:%s/` substitution does, or a `g/` g command.","published":true,"id":6},{"title":"Dear Red Hat... featuring Jeff Geerling (Changelog & Friends #7) |> Changelog","link":"https://changelog.com/friends/7","tags":"","message":"Loved this explanation about all the recent lock down with RHEL from Jeff Geerling.","published":true,"id":5},{"title":"How to pull from images from docker.io with podman","link":"https://gist.github.com/isomorphisms/3114ab86960656a729a6b4653001aae2","tags":"docker, podman, linux","message":"By default podman will not pull images from docker.io and will need setup.  This guide worked for me.","published":true,"id":4},{"title":"python script is not found","link":"None","tags":"python","message":"When setting up a new machine, vm, docker image you might be installing command line tools from places like pip.  They will often put executables in your `~/.local/bin` directory, but by default your shell is not looking in that directory for commands.\n\n``` bash\n  WARNING: The script dotenv is installed in '/home/falcon/.local/bin' which is not on PATH.\n  Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.\n```\n\nTo solve this you need to add that directory to your $PATH.\n\n\n``` bash\nexport PATH=$PATH:~/.local/bin\n```\n\nTo make this change permanant add this line to your shell's init script, which is likely something like `~/.bashrc` or `~/.zshrc`.","published":true,"id":3},{"title":"LazyVim Installation","link":"https://www.lazyvim.org/installation","tags":"vim, linux","message":"Lately in 2023 I have been leaning on lazyvim for my new setups where I am not necessarily ready to drop my full config.  It's been pretty solid, and comes with a very nice setup out of the box, the docs are pretty fantastic as well.","published":true,"id":2}]